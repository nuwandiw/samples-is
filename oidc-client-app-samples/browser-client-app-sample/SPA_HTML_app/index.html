<!DOCTYPE html>
<!--
~ Copyright (c) 2018 WSO2 Inc. (http://wso2.com) All Rights Reserved.
~
~ Licensed under the Apache License, Version 2.0 (the "License");
~ you may not use this file except in compliance with the License.
~ You may obtain a copy of the License at
~
~ http://www.apache.org/licenses/LICENSE-2.0
~
~ Unless required by applicable law or agreed to in writing, software
~ distributed under the License is distributed on an "AS IS" BASIS,
~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
~ See the License for the specific language governing permissions and
~ limitations under the License.
-->
<html>

<head>
  <title>WSO2-IAM OIDC SPA App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
  <div class="login-dispatch" style="height:100%" id="indexPage">
    <section id="login">
      <div class="container">
        <div class="row">
          <div class="col-md-4 col-md-offset-4">
            <div class="form-wrap-header">
              <img src="img/logo.png" class="center-block pickup-logo-login" alt="pickup-logo" />
              <span class="app-title center-block">WSO2-IAM OIDC Public Client</span>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4 col-md-offset-4">
            <div class="form-wrap">
              <!--button class="btn btn-custom btn-lg btn-block custom-primary add-margin-top-4x" id="fetchConfig">Fetch Configuration</button-->
              <button class="btn btn-custom btn-lg btn-block custom-primary add-margin-top-4x" id="authorize">Login</button>
            </div>
          </div>
        </div>
      </div>
    </section>
    <footer id="footer" class="login-footer login-dispatch">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <span class="text-muted">Copyright &copy;  <a href="http://wso2.com/" target="_blank" class="wso2-logo-link"><img src="img/wso2-light.svg" class="wso2-logo" alt="wso2-logo" /></a> &nbsp;2018</span>
          </div>
        </div>
      </div>
    </footer>  
  </div>

  <div style="height:100%" id="homePage">
      <nav id="top" class="navbar navbar-inverse navbar-custom">
          <div class="container-fluid">
             <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#dispatch-navbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#"><img src="img/logo.png" alt="pickup-logo" class="pickup-logo"/> Dispatch</a>
             </div>
             <div class="collapse navbar-collapse" id="dispatch-navbar">
                <ul class="nav navbar-nav navbar-right">
                   <!--<li><button class="btn btn-dark custom-primary btn-login"><strong>Login</strong></button></li>-->
                   <li class="dropdown user-name">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                      <img class="img-circle user-icon" src="img/user-icon.jpg" alt="user-icon"> <span class="user-name">kim@pickup.com <i class="fa fa-chevron-down"></i></span>
                      </a>
                      <ul class="dropdown-menu" role="menu">
                         <li><a href="#" id="showProfilePage">Profile</a></li>
                         <li><a href="#" id="makeHomePageLogoutRequest">Logout</a></li>
                      </ul>
                   </li>
                </ul>
             </div>
          </div>
       </nav>
       <!-- About -->
       <section id="about" class="about">
          <div class="container">
             <div class="row">
                <div class="col-md-12 text-center">
                   <h2><strong>PickUp Dispatch</strong></h2>
                   <p class="lead">A vehicle allocation application used to allocate drivers to vehicles</p>
                </div>
             </div>
          </div>
       </section>
       <section id="allocations" class="services">
          <div class="container">
             <div class="row text-center">
                <div class="col-md-10 col-md-offset-1">
                   <h3>Allocations</h3>
                   <hr class="small">
                   <div class="row">
                      <div class="col-md-3 col-md-offset-3 col-sm-6 col-xs-6 tab-nav">
                         <a href="" class=" allocations" >
                            <div class="service-item">
                               <span class="fa-stack fa-3x">
                               <i class="fa fa-circle fa-stack-2x circle "></i>
                               <i class="fa fa-tasks fa-stack-1x text-link"></i>
                               </span>
                               <span class="text-gray">
                                  <h4><strong>Create</strong></h4>
                                  <br/>
                               </span>
                            </div>
                         </a>
                      </div>
                      <div class="col-md-3 col-sm-6 col-xs-6 tab-nav">
                         <a href="" class="allocations">
                            <div class="service-item">
                               <span class="fa-stack fa-3x">
                               <i class="fa fa-circle fa-stack-2x circle"></i>
                               <i class="fa fa-eye fa-stack-1x text-link"></i>
                               </span>
                               <span class="text-gray">
                                  <h4><strong>View</strong></h4>
                                  <br/>
                               </span>
                            </div>
                         </a>
                      </div>
                   </div>
                </div>
             </div>
          </div>
       </section>
       <!-- Create -->
       <section class="create content">
          <div class="container">
             <div class="row">
                <div class="col-md-10 col-md-offset-1">
                   <h4 class="text-center">Create New Allocation</h4>
                   <div class="row">
                      <div class="col-md-6 col-md-offset-3">
                         <form>
                            <div class="form-group">
                               <label>Driver</label>
                               <select class="form-control">
                                  <option selected>Select a driver</option>
                                  <option>John</option>
                                  <option>David</option>
                                  <option>Jeffery</option>
                               </select>
                            </div>
                            <div class="form-group">
                               <label>Vehicle</label>
                               <select class="form-control">
                                  <option selected>Select a vehicle</option>
                                  <option>Car</option>
                                  <option>Van</option>
                                  <option>Jeep</option>
                               </select>
                            </div>
                            <div class="form-group">
                               <label>Vehicle Number</label>
                               <select class="form-control">
                                  <option selected>Select a vehicle number</option>
                                  <option>CA-1234</option>
                                  <option>KN-4567</option>
                                  <option>CJ-8910</option>
                               </select>
                            </div>
                            <div class="form-group">
                               <div class="row">
                                  <div class="col-md-6">
                                     <label>Date</label>
                                     <input type="password" class="form-control" placeholder="Enter allocation date">
                                  </div>
                                  <div class="col-md-6">
                                     <label>Time</label>
                                     <input type="password" class="form-control" placeholder="Enter allocation time">
                                  </div>
                               </div>
                            </div>
                            <div class="form-group">
                               <label>Period</label>
                               <input type="password" class="form-control" placeholder="Enter allocation period">
                            </div>
                            <button type="submit" class="btn btn-lg btn-dark custom-primary center-block">Create</button>
                         </form>
                      </div>
                   </div>
                </div>
             </div>
          </div>
       </section>
       <!-- View -->
       <section id="view" class="view content hide">
          <div class="container">
             <div class="row">
                <div class="col-md-10 col-md-offset-1">
                   <h4 class="text-center">View Allocations</h4>
                   <br/>
                   <div class="table-responsive">
                      <table class="table table-bordered" width="100%" id="dataTable" cellspacing="0">
                         <thead>
                            <tr>
                               <th>Driver</th>
                               <th>Vehicle</th>
                               <th>Vehicle No</th>
                               <th>Date</th>
                               <th>Time</th>
                               <th>Period</th>
                               <th></th>
                            </tr>
                         </thead>
                         <tbody>
                            <tr>
                               <td>Tiger Nixon</td>
                               <td>Car</td>
                               <td>CN-1234</td>
                               <td>2017/04/15</td>
                               <td>07:00</td>
                               <td>7 days</td>
                               <td><i class="fa fa-trash"></i></td>
                            </tr>
                            <tr>
                               <td>Garrett Winters</td>
                               <td>Van</td>
                               <td>KC-3543</td>
                               <td>2017/04/25</td>
                               <td>02:30</td>
                               <td>5 days</td>
                               <td><i class="fa fa-trash"></i></td>
                            </tr>
                            <tr>
                               <td>Ashton Cox</td>
                               <td>Car</td>
                               <td>CA-8877</td>
                               <td>2017/01/12</td>
                               <td>05:30</td>
                               <td>10 days</td>
                               <td><i class="fa fa-trash"></i></td>
                            </tr>
                         </tbody>
                      </table>
                   </div>
                </div>
             </div>
          </div>
       </section>
       <!-- Footer -->
       <footer id="footer">
          <div class="container">
             <div class="row">
                <div class="col-md-10 col-md-offset-1 text-center">
                   <span class="text-muted">Copyright &copy;  <a href="http://wso2.com/" target="_blank" class="wso2-logo-link"><img src="img/wso2-dark.svg" class="wso2-logo" alt="wso2-logo"/></a> &nbsp;2018</span>
                </div>
             </div>
          </div>
          <a id="to-top" href="#top" class="btn btn-dark btn-lg"><i class="fa fa-chevron-up fa-fw fa-1x"></i></a>
       </footer>
  </div>

  <div style="height:100%" id="profilePage">
      <nav id="top" class="navbar navbar-inverse navbar-custom">
          <div class="container-fluid">
             <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#dispatch-navbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#"><img src="img/logo.png" alt="pickup-logo" class="pickup-logo"/> Dispatch</a>
             </div>
             <div class="collapse navbar-collapse" id="dispatch-navbar">
                <ul class="nav navbar-nav navbar-right">
                   <!--<li><button class="btn btn-dark custom-primary btn-login"><strong>Login</strong></button></li>-->
                   <li class="dropdown user-name">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                      <img class="img-circle user-icon" src="img/user-icon.jpg" alt="user-icon"> <span class="user-name">kim@pickup.com <i class="fa fa-chevron-down"></i></span>
                      </a>
                      <ul class="dropdown-menu" role="menu">
                        <li><a href="#" id="showHomePage">Home</a></li>
                        <li><a href="#" id="makeProfilePageLogoutRequest">Logout</a></li>
                      </ul>
                   </li>
                </ul>
             </div>
          </div>
       </nav>
       <!-- About -->
       <section id="about" class="about">
          <div class="container">
             <div class="row">
                <div class="col-md-12 text-center">
                   <h2><strong>PickUp User Informartion</strong></h2>
                   <p class="lead">User information from the authentication server</p>
                </div>
             </div>
          </div>
       </section>
       <!-- View -->
       <section id="view" class="view content">
          <div class="container">
             <div class="row">
                <div class="col-md-10 col-md-offset-1">
                   <h4 class="text-center">View User Information</h4>
                   <br/>
                   <div class="table-responsive">
                      <table class="table table-bordered" width="100%" id="dataTable" cellspacing="0">
                         <thead>
                            <tr>
                               <th>User sub</th>
                               <th>User's name</th>
                               <th>Given name</th>
                               <th>Family name</th>
                               <th>Preferred username</th>
                               <th>Email</th>
                               <th>Picture</th>
                            </tr>
                         </thead>
                         <tbody>
                            <tr>
                               <td id="sub"></td>
                               <td id="name"></td>
                               <td id="given_name"></td>
                               <td id="family_name"></td>
                               <td id="preferred_username"></td>
                               <td id="email"></td>
                               <td id="picture_td"><a href="" id="picture" /></td>
                            </tr>
                         </tbody>
                      </table>
                   </div>
                </div>
             </div>
          </div>
       </section>
       <!-- Footer -->
       <footer id="footer">
          <div class="container">
             <div class="row">
                <div class="col-md-10 col-md-offset-1 text-center">
                   <span class="text-muted">Copyright &copy;  <a href="http://wso2.com/" target="_blank" class="wso2-logo-link"><img src="img/wso2-dark.svg" class="wso2-logo" alt="wso2-logo"/></a> &nbsp;2018</span>
                </div>
             </div>
          </div>
          <a id="to-top" href="#top" class="btn btn-dark btn-lg"><i class="fa fa-chevron-up fa-fw fa-1x"></i></a>
       </footer>
  </div>

  <!-- extras -->
  <!-- Bootstrap Core CSS -->
  <link href="libs/bootstrap_3.3.7/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="./css/app.css" />

  <!-- Custom Fonts -->
  <link href="libs/font-awesome_4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link href="css/font.css" rel="stylesheet" type="text/css">
  <!-- scripts -->
  <script src="js/jquery-3.2.1.min.js"></script>
  <!-- Bootstrap Core JavaScript -->
  <script src="libs/bootstrap_3.3.7/js/bootstrap.min.js"></script>
  <script src="./js/bundle.js"></script>
  <script src="./js/appauth_js_ext_logout.js"></script>
  <script src="./js/appauth_js_ext_pkce.js"></script>
  <script src="./js/appauth_js_ext_userinfo.js"></script>
  <script src="./js/app.js"></script>
  <script type="text/javascript">

    function authCompletionCallback() {
      $('#indexPage').hide();
      $('#homePage').show();
      $('#profilePage').hide();
    }

    function logoutCompletionCallback() {
      $('#indexPage').show();
      $('#homePage').hide();
      $('#profilePage').hide();
    }

    var appArray = null;
    // initialize app when MDL is ready to go.
    window.addEventListener('load', function () {
      console.log('Initializing App.');

      $('#indexPage').show();
      $('#homePage').hide();
      $('#profilePage').hide();

      appArray = init(authCompletionCallback, logoutCompletionCallback);
    });

    // show home page
    var showHomePage = document.querySelector('#showHomePage');
    showHomePage.addEventListener('click', function (event) {
      $('#indexPage').hide();
      $('#homePage').show();
      $('#profilePage').hide();

      event.preventDefault();
    });

    // show profile page
    var showProfilePage = document.querySelector('#showProfilePage');
    showProfilePage.addEventListener('click', function (event) {

      // userInfo route only works with only PKCE for now and have to do for implicit by decoding the id_token JWT
      appArray[3].makeUserInfoRequest().then(userInfoJson => {
        $("#sub").text(userInfoJson.sub);
        $("#name").text(userInfoJson.name);
        $("#given_name").text(userInfoJson.given_name);
        $("#family_name").text(userInfoJson.family_name);
        $("#preferred_username").text(userInfoJson.preferred_username);
        $("#email").text(userInfoJson.email);
        $("#picture").text(userInfoJson.picture);

        $('#indexPage').hide();
        $('#homePage').hide();
        $('#profilePage').show();
      });

      event.preventDefault();
    });

    // authorize request handler
    var authorize = document.querySelector('#authorize');
    authorize.addEventListener('click', function (event) {
      makeAuthorizationRequest();
      event.preventDefault();
    });

    // logout request handler
    function makeLogoutRequest(event) {
        appArray[1].makeLogoutRequest();
        event.preventDefault();
    }

    var makeHomePageLogoutRequest = document.querySelector('#makeHomePageLogoutRequest');
    makeHomePageLogoutRequest.addEventListener('click', makeLogoutRequest);

    var makeProfilePageLogoutRequest = document.querySelector('#makeProfilePageLogoutRequest');
    makeProfilePageLogoutRequest.addEventListener('click', makeLogoutRequest);
  </script>
</body>

</html>
